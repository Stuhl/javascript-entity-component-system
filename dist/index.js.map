{"mappings":"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","sources":["src/index.ts"],"sourcesContent":["export type Component = {\r\n  name : string\r\n  state: object\r\n  onAttach?: Function\r\n  onDetach?: Function\r\n}\r\n\r\nexport type ComponentArgument = {\r\n  name  : string\r\n  state?: object\r\n}\r\n\r\nexport type Processor = {\r\n  name  : string\r\n  target: string\r\n  update(component: Component, entities: Entity[]): void\r\n}\r\n\r\nexport type Entity = {\r\n  name      : string\r\n  components: string[]\r\n  state     : {\r\n    [key: string]: any\r\n  }\r\n  update?: Function\r\n}\r\n\r\n/**\r\n * The Entity Component System class.\r\n */\r\nexport default class EntityComponentSystem {\r\n  /**\r\n   * All registered components\r\n   * @defaultValue []\r\n   */\r\n  components: Component[]\r\n\r\n  /**\r\n   * All registered processors\r\n   * @defaultValue []\r\n   */\r\n  processors: Processor[]\r\n\r\n  /**\r\n   * All registered entities\r\n   * @defaultValue []\r\n   */\r\n  entities  : Entity[]\r\n  \r\n  constructor() {\r\n    this.components = []\r\n    this.processors = []\r\n    this.entities   = []\r\n  }\r\n\r\n  /**\r\n  * Gets registered processor names.\r\n  * @returns All registered processor names in an array.\r\n  */\r\n  getProcessorNames(): string[] {\r\n    return this.processors.map(processor => processor.name)\r\n  }\r\n\r\n  /**\r\n   * Gets all registered processors.\r\n   * @returns All registered processors in an array.\r\n   */\r\n  getProcessors(): Processor[] {\r\n    return this.processors\r\n  }\r\n\r\n  /**\r\n   * Gets all components processors.\r\n   * @returns All registered components in an array.\r\n   */\r\n  getComponents(): Component[] {\r\n    return this.components\r\n  }\r\n\r\n  /**\r\n   * Gets all registered entities.\r\n   * @returns All registered entities in an array.\r\n   */\r\n  getEntities(): Entity[] {\r\n    return this.entities\r\n  }\r\n\r\n  /**\r\n   * Gets a registered processor by name.\r\n   * @param name - Name of the processor\r\n   * @returns A processor or throws an error.\r\n   */\r\n  getProcessor(name: string): Processor {\r\n    const hasProcessor = this.hasProcessor(name)\r\n\r\n    if (!hasProcessor) {\r\n      throw new Error(`getProcessor(): processor \"${name}\" not found.`)\r\n    }\r\n\r\n    return this.processors.find((processor) => processor.name === name) as Processor\r\n  }\r\n\r\n  /**\r\n   * Gets a registered component by name.\r\n   * @param name - Name of the component\r\n   * @returns A component or throws an error.\r\n   */\r\n  getComponent(name: string): Component {\r\n    const hasComponent = this.hasComponent(name)\r\n\r\n    if (!hasComponent) {\r\n      throw new Error(`getComponent(): component \"${name}\" not found.`)\r\n    }\r\n\r\n    return this.components.find((component) => component.name === name) as Component\r\n  }\r\n\r\n  /**\r\n   * Gets a registered entity by name.\r\n   * @param name -Name of the entity\r\n   * @returnsA A entity or throws an error. \r\n   */\r\n  getEntity(name: string): Component {\r\n    const hasEntity = this.hasEntity(name)\r\n\r\n    if (!hasEntity) {\r\n      throw new Error(`getEntity(): entity \"${name}\" not found.`)\r\n    }\r\n\r\n    return this.entities.find((entity) => entity.name === name) as Entity\r\n  }\r\n\r\n  /**\r\n   * Checks if processor is registered by name.\r\n   * @param name - Name of the processor\r\n   * @returns true if found or false if not.\r\n   */\r\n  hasProcessor(name: string): boolean {\r\n    let found = false\r\n    \r\n    for (let processor of this.processors) {\r\n      if (processor.name === name) {\r\n        found = true\r\n      }\r\n    }\r\n\r\n    return found\r\n  }\r\n\r\n  /**\r\n   * Checks if component is registered.\r\n   * @param name - Name of the component\r\n   * @returns true if found or false if not.\r\n   */\r\n  hasComponent(name: string): boolean {\r\n    let found = false\r\n\r\n    for (let component of this.components) {\r\n      if (component.name === name) {\r\n        found = true\r\n      }\r\n    }\r\n\r\n    return found\r\n  }\r\n\r\n  /**\r\n   * Checks if entity is registered.\r\n   * @param name - Name of the entity\r\n   * @returns true if found or false if not.\r\n   */\r\n  hasEntity(name: string): boolean {\r\n    let found = false\r\n\r\n    for (let entity of this.entities) {\r\n      if (entity.name === name) {\r\n        found = true\r\n      }\r\n    }\r\n\r\n    return found\r\n  }\r\n\r\n  /**\r\n   * Composes a entity with given components.\r\n   * @param name - Name of the entity\r\n   * @param components - An array of component names\r\n   * @returns The composed entity or throws an error.\r\n   */\r\n  createEntity(name: string, components: string[]): Entity {\r\n    let entity = {\r\n      name,\r\n      components,\r\n      state: {}\r\n    }\r\n\r\n    components.forEach(component => {\r\n      const foundComponent = this.components.find((ECSComponent) => component === ECSComponent.name)\r\n\r\n      if (!foundComponent) {\r\n        throw new Error(`createEntity(): component ${component} not found. You probably forgot to register the component in the system.`)\r\n      }\r\n\r\n      entity.state = Object.assign(entity.state, foundComponent.state)\r\n    })\r\n\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * Checks if an entity has target component.\r\n   * @param entity - entity object\r\n   * @param component - Name of component\r\n   * @returns true if entity has the component or false if not\r\n   */\r\n  entityHasComponent(entity: Entity, component: string): boolean {\r\n    return entity.components.includes(component)\r\n  }\r\n\r\n  /**\r\n   * Removes component from an entity.\r\n   * @param entity - entity object\r\n   * @param component - Name of component\r\n   * @returns Void if operation successful or throw an error.\r\n   */\r\n  removeComponentFromEntity(entity: Entity, targetComponent: string): void {\r\n    const indexOfComponent = entity.components.indexOf(targetComponent)\r\n\r\n    if (indexOfComponent === -1) {\r\n      throw new Error(`removeComponentFromEntity(): component ${targetComponent} not found in entity ${entity.name}`)\r\n    }\r\n\r\n    entity.components = entity.components.filter(component => component !== targetComponent)\r\n    const component   = this.getComponent(targetComponent)\r\n    const keys        = Object.keys(component.state)\r\n\r\n    keys.forEach(key => {\r\n      delete entity[key]\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Adds a component to an entity.\r\n   * @param entity - entity object\r\n   * @param component - Name of component\r\n   * @returns Void if operation is successful or throws an error.\r\n   */\r\n  addComponentToEntity(entity: Entity, component: string): void {\r\n    if (this.entityHasComponent(entity, component)) {\r\n      throw new Error(`addComponentToEntity(): Can't add component ${component} - this entity already has this component.`)\r\n    }\r\n\r\n    const isComponentRegistered = this.hasComponent(component)\r\n\r\n    if (!isComponentRegistered) {\r\n      throw new Error(`addComponentToEntity(): You can't add component ${component} to entity ${entity}, because the component is not registered.`)\r\n    }\r\n\r\n    const targetComponent = this.getComponent(component)\r\n\r\n    entity = Object.assign(entity, targetComponent.state ? targetComponent.state : {})\r\n    entity.components.push(targetComponent.name)\r\n  }\r\n\r\n  /**\r\n   * Adds a entity to the system.\r\n   * @param entity - entity object\r\n   * @returns Void if successful\r\n   */\r\n  addEntity(entity: Entity): void {\r\n    this.entities.push(entity)\r\n  }\r\n\r\n  /**\r\n   * Adds a component to the system.\r\n   * @param component - component object\r\n   * @returns Void if successful\r\n   */\r\n  addComponent(component: ComponentArgument): void {\r\n    const passedComponent = component as Component\r\n    passedComponent.state = component.state ? passedComponent.state : {}\r\n\r\n    if (passedComponent.onAttach) {\r\n      passedComponent.onAttach()\r\n    }\r\n\r\n    this.components.push(passedComponent)\r\n  }\r\n\r\n  /**\r\n   * Adds a processor to the system.\r\n   * @param processor - processor object\r\n   * @returns Void if successful\r\n   */\r\n  addProcessor(processor: Processor): void {\r\n    this.processors.push(processor)\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from the system.\r\n   * @param entity - entity object\r\n   * @returns Void if successful or throws an error.\r\n   */\r\n  removeEntity(entity: Entity): void {\r\n    const indexOf = this.entities.indexOf(entity)\r\n\r\n    if (indexOf === -1) {\r\n      throw new Error(`removeEntity(): entity \"${entity.name}\" not found.`)\r\n    }\r\n\r\n    this.entities.splice(indexOf, 1)\r\n  }\r\n\r\n  /**\r\n   * Gets all entities that have the target component registered.\r\n   * @param componentName - Name of the component\r\n   * @returns All entities in an array.\r\n   */\r\n  private getEntitiesFromComponent(componentName: string): Entity[] {\r\n    return this.entities.filter(entity => {\r\n      return entity.components.includes(componentName)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Runs all processors for it's corresponding components e.g. run the prcoessors update function.\r\n   * @returns Void if successful\r\n   */\r\n  private runProcessors(): void {\r\n    this.processors.forEach(processor => {\r\n      const entities  = this.getEntitiesFromComponent(processor.target)\r\n      const component = this.getComponent(processor.target)\r\n\r\n      processor.update(component, entities)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Run custom logic of an entity e.g. run entity.update()\r\n   * @returns Void if successful\r\n   */\r\n  private runCustomLogicOnEntities(): void {\r\n    this.entities.forEach(entity => {\r\n      if (entity.update) {\r\n        entity.update()\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Runs all processors. This should be done per frame e.g. inside your gameloop.\r\n   * @returns Void if successful\r\n   */\r\n  update(): void {\r\n    this.runProcessors()\r\n    this.runCustomLogicOnEntities()\r\n  }\r\n}"],"names":["$eb7869949b641a40$export$2e2bcd8739ae039","constructor","this","components","processors","entities","getProcessorNames","map","processor","name","getProcessors","getComponents","getEntities","getProcessor","hasProcessor","Error","find","getComponent","hasComponent","component","getEntity","hasEntity","entity","found","createEntity","state","forEach","foundComponent","ECSComponent","Object","assign","entityHasComponent","includes","removeComponentFromEntity","targetComponent","indexOf","filter","keys","key","addComponentToEntity","push","addEntity","addComponent","passedComponent","onAttach","addProcessor","removeEntity","splice","getEntitiesFromComponent","componentName","runProcessors","target","update","runCustomLogicOnEntities"],"version":3,"file":"index.js.map"}