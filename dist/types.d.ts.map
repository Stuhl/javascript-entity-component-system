{"mappings":"AAAA,wBAAwB;IACtB,IAAI,EAAG,MAAM,CAAA;IACb,KAAK,EAAE,MAAM,CAAA;IACb,QAAQ,CAAC,EAAE,QAAQ,CAAA;IACnB,QAAQ,CAAC,EAAE,QAAQ,CAAA;CACpB,CAAA;AAED,gCAAgC;IAC9B,IAAI,EAAI,MAAM,CAAA;IACd,KAAK,CAAC,EAAE,MAAM,CAAA;CACf,CAAA;AAED,wBAAwB;IACtB,IAAI,EAAI,MAAM,CAAA;IACd,MAAM,EAAE,MAAM,CAAA;IACd,MAAM,CAAC,SAAS,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAI,CAAA;CACvD,CAAA;AAED,qBAAqB;IACnB,IAAI,EAAQ,MAAM,CAAA;IAClB,UAAU,EAAE,MAAM,EAAE,CAAA;IACpB,KAAK,EAAO;QACV,CAAC,GAAG,EAAE,MAAM,GAAG,GAAG,CAAA;KACnB,CAAA;IACD,MAAM,CAAC,EAAE,QAAQ,CAAA;CAClB,CAAA;AAED;;GAEG;AACH;IACE;;;OAGG;IACH,UAAU,EAAE,SAAS,EAAE,CAAA;IAEvB;;;OAGG;IACH,UAAU,EAAE,SAAS,EAAE,CAAA;IAEvB;;;OAGG;IACH,QAAQ,EAAI,MAAM,EAAE,CAAA;;IAQpB;;;MAGE;IACF,iBAAiB,IAAI,MAAM,EAAE;IAI7B;;;OAGG;IACH,aAAa,IAAI,SAAS,EAAE;IAI5B;;;OAGG;IACH,aAAa,IAAI,SAAS,EAAE;IAI5B;;;OAGG;IACH,WAAW,IAAI,MAAM,EAAE;IAIvB;;;;OAIG;IACH,YAAY,CAAC,IAAI,EAAE,MAAM,GAAG,SAAS;IAUrC;;;;OAIG;IACH,YAAY,CAAC,IAAI,EAAE,MAAM,GAAG,SAAS;IAUrC;;;;OAIG;IACH,SAAS,CAAC,IAAI,EAAE,MAAM,GAAG,SAAS;IAUlC;;;;OAIG;IACH,YAAY,CAAC,IAAI,EAAE,MAAM,GAAG,OAAO;IAYnC;;;;OAIG;IACH,YAAY,CAAC,IAAI,EAAE,MAAM,GAAG,OAAO;IAYnC;;;;OAIG;IACH,SAAS,CAAC,IAAI,EAAE,MAAM,GAAG,OAAO;IAYhC;;;;;OAKG;IACH,YAAY,CAAC,IAAI,EAAE,MAAM,EAAE,UAAU,EAAE,MAAM,EAAE,GAAG,MAAM;IAoBxD;;;;;OAKG;IACH,kBAAkB,CAAC,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,GAAG,OAAO;IAI9D;;;;;OAKG;IACH,yBAAyB,CAAC,MAAM,EAAE,MAAM,EAAE,eAAe,EAAE,MAAM,GAAG,IAAI;IAgBxE;;;;;OAKG;IACH,oBAAoB,CAAC,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,GAAG,IAAI;IAiB7D;;;;OAIG;IACH,SAAS,CAAC,MAAM,EAAE,MAAM,GAAG,IAAI;IAI/B;;;;OAIG;IACH,YAAY,CAAC,SAAS,EAAE,iBAAiB,GAAG,IAAI;IAWhD;;;;OAIG;IACH,YAAY,CAAC,SAAS,EAAE,SAAS,GAAG,IAAI;IAIxC;;;;OAIG;IACH,YAAY,CAAC,MAAM,EAAE,MAAM,GAAG,IAAI;IA8ClC;;;OAGG;IACH,MAAM,IAAI,IAAI;CAIf","sources":["src/src/index.ts","src/index.ts"],"sourcesContent":[null,"export type Component = {\r\n  name : string\r\n  state: object\r\n  onAttach?: Function\r\n  onDetach?: Function\r\n}\r\n\r\nexport type ComponentArgument = {\r\n  name  : string\r\n  state?: object\r\n}\r\n\r\nexport type Processor = {\r\n  name  : string\r\n  target: string\r\n  update(component: Component, entities: Entity[]): void\r\n}\r\n\r\nexport type Entity = {\r\n  name      : string\r\n  components: string[]\r\n  state     : {\r\n    [key: string]: any\r\n  }\r\n  update?: Function\r\n}\r\n\r\n/**\r\n * The Entity Component System class.\r\n */\r\nexport default class EntityComponentSystem {\r\n  /**\r\n   * All registered components\r\n   * @defaultValue []\r\n   */\r\n  components: Component[]\r\n\r\n  /**\r\n   * All registered processors\r\n   * @defaultValue []\r\n   */\r\n  processors: Processor[]\r\n\r\n  /**\r\n   * All registered entities\r\n   * @defaultValue []\r\n   */\r\n  entities  : Entity[]\r\n  \r\n  constructor() {\r\n    this.components = []\r\n    this.processors = []\r\n    this.entities   = []\r\n  }\r\n\r\n  /**\r\n  * Gets registered processor names.\r\n  * @returns All registered processor names in an array.\r\n  */\r\n  getProcessorNames(): string[] {\r\n    return this.processors.map(processor => processor.name)\r\n  }\r\n\r\n  /**\r\n   * Gets all registered processors.\r\n   * @returns All registered processors in an array.\r\n   */\r\n  getProcessors(): Processor[] {\r\n    return this.processors\r\n  }\r\n\r\n  /**\r\n   * Gets all components processors.\r\n   * @returns All registered components in an array.\r\n   */\r\n  getComponents(): Component[] {\r\n    return this.components\r\n  }\r\n\r\n  /**\r\n   * Gets all registered entities.\r\n   * @returns All registered entities in an array.\r\n   */\r\n  getEntities(): Entity[] {\r\n    return this.entities\r\n  }\r\n\r\n  /**\r\n   * Gets a registered processor by name.\r\n   * @param name - Name of the processor\r\n   * @returns A processor or throws an error.\r\n   */\r\n  getProcessor(name: string): Processor {\r\n    const hasProcessor = this.hasProcessor(name)\r\n\r\n    if (!hasProcessor) {\r\n      throw new Error(`getProcessor(): processor \"${name}\" not found.`)\r\n    }\r\n\r\n    return this.processors.find((processor) => processor.name === name) as Processor\r\n  }\r\n\r\n  /**\r\n   * Gets a registered component by name.\r\n   * @param name - Name of the component\r\n   * @returns A component or throws an error.\r\n   */\r\n  getComponent(name: string): Component {\r\n    const hasComponent = this.hasComponent(name)\r\n\r\n    if (!hasComponent) {\r\n      throw new Error(`getComponent(): component \"${name}\" not found.`)\r\n    }\r\n\r\n    return this.components.find((component) => component.name === name) as Component\r\n  }\r\n\r\n  /**\r\n   * Gets a registered entity by name.\r\n   * @param name -Name of the entity\r\n   * @returnsA A entity or throws an error. \r\n   */\r\n  getEntity(name: string): Component {\r\n    const hasEntity = this.hasEntity(name)\r\n\r\n    if (!hasEntity) {\r\n      throw new Error(`getEntity(): entity \"${name}\" not found.`)\r\n    }\r\n\r\n    return this.entities.find((entity) => entity.name === name) as Entity\r\n  }\r\n\r\n  /**\r\n   * Checks if processor is registered by name.\r\n   * @param name - Name of the processor\r\n   * @returns true if found or false if not.\r\n   */\r\n  hasProcessor(name: string): boolean {\r\n    let found = false\r\n    \r\n    for (let processor of this.processors) {\r\n      if (processor.name === name) {\r\n        found = true\r\n      }\r\n    }\r\n\r\n    return found\r\n  }\r\n\r\n  /**\r\n   * Checks if component is registered.\r\n   * @param name - Name of the component\r\n   * @returns true if found or false if not.\r\n   */\r\n  hasComponent(name: string): boolean {\r\n    let found = false\r\n\r\n    for (let component of this.components) {\r\n      if (component.name === name) {\r\n        found = true\r\n      }\r\n    }\r\n\r\n    return found\r\n  }\r\n\r\n  /**\r\n   * Checks if entity is registered.\r\n   * @param name - Name of the entity\r\n   * @returns true if found or false if not.\r\n   */\r\n  hasEntity(name: string): boolean {\r\n    let found = false\r\n\r\n    for (let entity of this.entities) {\r\n      if (entity.name === name) {\r\n        found = true\r\n      }\r\n    }\r\n\r\n    return found\r\n  }\r\n\r\n  /**\r\n   * Composes a entity with given components.\r\n   * @param name - Name of the entity\r\n   * @param components - An array of component names\r\n   * @returns The composed entity or throws an error.\r\n   */\r\n  createEntity(name: string, components: string[]): Entity {\r\n    let entity = {\r\n      name,\r\n      components,\r\n      state: {}\r\n    }\r\n\r\n    components.forEach(component => {\r\n      const foundComponent = this.components.find((ECSComponent) => component === ECSComponent.name)\r\n\r\n      if (!foundComponent) {\r\n        throw new Error(`createEntity(): component ${component} not found. You probably forgot to register the component in the system.`)\r\n      }\r\n\r\n      entity.state = Object.assign(entity.state, foundComponent.state)\r\n    })\r\n\r\n    return entity\r\n  }\r\n\r\n  /**\r\n   * Checks if an entity has target component.\r\n   * @param entity - entity object\r\n   * @param component - Name of component\r\n   * @returns true if entity has the component or false if not\r\n   */\r\n  entityHasComponent(entity: Entity, component: string): boolean {\r\n    return entity.components.includes(component)\r\n  }\r\n\r\n  /**\r\n   * Removes component from an entity.\r\n   * @param entity - entity object\r\n   * @param component - Name of component\r\n   * @returns Void if operation successful or throw an error.\r\n   */\r\n  removeComponentFromEntity(entity: Entity, targetComponent: string): void {\r\n    const indexOfComponent = entity.components.indexOf(targetComponent)\r\n\r\n    if (indexOfComponent === -1) {\r\n      throw new Error(`removeComponentFromEntity(): component ${targetComponent} not found in entity ${entity.name}`)\r\n    }\r\n\r\n    entity.components = entity.components.filter(component => component !== targetComponent)\r\n    const component   = this.getComponent(targetComponent)\r\n    const keys        = Object.keys(component.state)\r\n\r\n    keys.forEach(key => {\r\n      delete entity[key]\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Adds a component to an entity.\r\n   * @param entity - entity object\r\n   * @param component - Name of component\r\n   * @returns Void if operation is successful or throws an error.\r\n   */\r\n  addComponentToEntity(entity: Entity, component: string): void {\r\n    if (this.entityHasComponent(entity, component)) {\r\n      throw new Error(`addComponentToEntity(): Can't add component ${component} - this entity already has this component.`)\r\n    }\r\n\r\n    const isComponentRegistered = this.hasComponent(component)\r\n\r\n    if (!isComponentRegistered) {\r\n      throw new Error(`addComponentToEntity(): You can't add component ${component} to entity ${entity}, because the component is not registered.`)\r\n    }\r\n\r\n    const targetComponent = this.getComponent(component)\r\n\r\n    entity = Object.assign(entity, targetComponent.state ? targetComponent.state : {})\r\n    entity.components.push(targetComponent.name)\r\n  }\r\n\r\n  /**\r\n   * Adds a entity to the system.\r\n   * @param entity - entity object\r\n   * @returns Void if successful\r\n   */\r\n  addEntity(entity: Entity): void {\r\n    this.entities.push(entity)\r\n  }\r\n\r\n  /**\r\n   * Adds a component to the system.\r\n   * @param component - component object\r\n   * @returns Void if successful\r\n   */\r\n  addComponent(component: ComponentArgument): void {\r\n    const passedComponent = component as Component\r\n    passedComponent.state = component.state ? passedComponent.state : {}\r\n\r\n    if (passedComponent.onAttach) {\r\n      passedComponent.onAttach()\r\n    }\r\n\r\n    this.components.push(passedComponent)\r\n  }\r\n\r\n  /**\r\n   * Adds a processor to the system.\r\n   * @param processor - processor object\r\n   * @returns Void if successful\r\n   */\r\n  addProcessor(processor: Processor): void {\r\n    this.processors.push(processor)\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from the system.\r\n   * @param entity - entity object\r\n   * @returns Void if successful or throws an error.\r\n   */\r\n  removeEntity(entity: Entity): void {\r\n    const indexOf = this.entities.indexOf(entity)\r\n\r\n    if (indexOf === -1) {\r\n      throw new Error(`removeEntity(): entity \"${entity.name}\" not found.`)\r\n    }\r\n\r\n    this.entities.splice(indexOf, 1)\r\n  }\r\n\r\n  /**\r\n   * Gets all entities that have the target component registered.\r\n   * @param componentName - Name of the component\r\n   * @returns All entities in an array.\r\n   */\r\n  private getEntitiesFromComponent(componentName: string): Entity[] {\r\n    return this.entities.filter(entity => {\r\n      return entity.components.includes(componentName)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Runs all processors for it's corresponding components e.g. run the prcoessors update function.\r\n   * @returns Void if successful\r\n   */\r\n  private runProcessors(): void {\r\n    this.processors.forEach(processor => {\r\n      const entities  = this.getEntitiesFromComponent(processor.target)\r\n      const component = this.getComponent(processor.target)\r\n\r\n      processor.update(component, entities)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Run custom logic of an entity e.g. run entity.update()\r\n   * @returns Void if successful\r\n   */\r\n  private runCustomLogicOnEntities(): void {\r\n    this.entities.forEach(entity => {\r\n      if (entity.update) {\r\n        entity.update()\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Runs all processors. This should be done per frame e.g. inside your gameloop.\r\n   * @returns Void if successful\r\n   */\r\n  update(): void {\r\n    this.runProcessors()\r\n    this.runCustomLogicOnEntities()\r\n  }\r\n}"],"names":[],"version":3,"file":"types.d.ts.map"}